import{toClassName}from"../../scripts/aem.js";function createFieldWrapper(e){var t=document.createElement("div");return e.Style&&(t.className=e.Style),t.classList.add("field-wrapper",e.Type+"-wrapper"),t.dataset.fieldset=e.Fieldset,t}let ids=[];function generateFieldId(e,t=""){e=toClassName("form-"+e.Name+t),ids[e]=ids[e]||0,t=ids[e]?"-"+ids[e]:"";return ids[e]+=1,e+t}function createLabel(e){var t=document.createElement("label");return t.id=generateFieldId(e,"-label"),t.textContent=e.Label||e.Name,t.setAttribute("for",e.Id),"true"!==e.Mandatory.toLowerCase()&&"x"!==e.Mandatory.toLowerCase()||(t.dataset.required=!0),t}function setCommonAttributes(e,t){e.id=t.Id,e.name=t.Name,e.required=t.Mandatory&&("true"===t.Mandatory.toLowerCase()||"x"===t.Mandatory.toLowerCase()),e.placeholder=t.Placeholder,e.value=t.Value}let createHeading=e=>{var t=createFieldWrapper(e),a=e.Style&&e.Style.includes("sub-heading")?3:2,a=document.createElement("h"+a);return a.textContent=e.Value||e.Label,a.id=e.Id,t.append(a),{field:a,fieldWrapper:t}},createPlaintext=e=>{var t=createFieldWrapper(e),a=document.createElement("p");return a.textContent=e.Value||e.Label,a.id=e.Id,t.append(a),{field:a,fieldWrapper:t}},createSelect=async e=>{let r=document.createElement("select"),a=(setCommonAttributes(r,e),({text:e,value:t})=>{var a=document.createElement("option");return a.text=e.trim(),a.value=t.trim(),a.value===r.value&&a.setAttribute("selected",""),r.add(a),a});if(e.Placeholder&&a({text:e.Placeholder,value:""}).setAttribute("disabled",""),e.Options){let t=[];e.Options.startsWith("https://")?(d=new URL(e.Options),(await(await fetch(""+d.pathname+d.search)).json()).data.forEach(e=>{t.push({text:e.Option,value:e.Value||e.Option})})):t=e.Options.split(",").map(e=>({text:e.trim(),value:e.trim().toLowerCase()})),t.forEach(e=>a(e))}var d=createFieldWrapper(e);return d.append(r),d.prepend(createLabel(e)),{field:r,fieldWrapper:d}},createConfirmation=(e,t)=>(t.dataset.confirmation=new URL(e.Value).pathname,{}),createSubmit=e=>{var t=document.createElement("button"),e=(t.textContent=e.Label||e.Name,t.classList.add("button"),t.type="submit",createFieldWrapper(e));return e.append(t),{field:t,fieldWrapper:e}},createTextArea=e=>{var t=document.createElement("textarea"),a=(setCommonAttributes(t,e),createFieldWrapper(e)),e=createLabel(e);return t.setAttribute("aria-labelledby",e.id),a.append(t),a.prepend(e),{field:t,fieldWrapper:a}},createInput=e=>{var t=document.createElement("input"),a=(t.type=e.Type,setCommonAttributes(t,e),createFieldWrapper(e)),r=createLabel(e);return t.setAttribute("aria-labelledby",r.id),a.append(t),"radio"===e.Type||"checkbox"===e.Type?a.append(r):a.prepend(r),{field:t,fieldWrapper:a}},createFieldset=e=>{var t=document.createElement("fieldset"),a=(setCommonAttributes(t,e),e.Label&&((a=document.createElement("legend")).textContent=e.Label,t.append(a)),createFieldWrapper(e));return a.append(t),{field:t,fieldWrapper:a}},createToggle=e=>{let{field:t,fieldWrapper:a}=createInput(e);t.type="checkbox",t.value||(t.value="on"),t.classList.add("toggle"),a.classList.add("selection-wrapper");var e=document.createElement("div"),r=(e.classList.add("switch"),e.append(t),a.append(e),document.createElement("span"));return r.classList.add("slider"),e.append(r),r.addEventListener("click",()=>{t.checked=!t.checked}),{field:t,fieldWrapper:a}},createCheckbox=e=>{var{field:e,fieldWrapper:t}=createInput(e);return e.value||(e.value="checked"),t.classList.add("selection-wrapper"),{field:e,fieldWrapper:t}},createRadio=e=>{var{field:t,fieldWrapper:a}=createInput(e);return t.value||(t.value=e.Label||"on"),a.classList.add("selection-wrapper"),{field:t,fieldWrapper:a}},FIELD_CREATOR_FUNCTIONS={select:createSelect,heading:createHeading,plaintext:createPlaintext,"text-area":createTextArea,toggle:createToggle,submit:createSubmit,confirmation:createConfirmation,fieldset:createFieldset,checkbox:createCheckbox,radio:createRadio};export default async function createField(e,t){e.Id=e.Id||generateFieldId(e);var a=e.Type.toLowerCase();return(await(FIELD_CREATOR_FUNCTIONS[a]||createInput)(e,t)).fieldWrapper}